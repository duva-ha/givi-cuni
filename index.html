<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>10A7 COMMAND - LUXURY EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; }
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #fef3c7; overflow-x: hidden; }
        .chinese-title { font-family: 'Noto Serif SC', serif; }
        .input-pro { background-color: #ffffff !important; color: #000000 !important; font-weight: 900 !important; height: 45px; padding: 0 15px; border-radius: 8px; width: 100%; border: none; outline: none; }
        .luxury-panel { background: linear-gradient(145deg, rgba(153, 27, 27, 0.05), rgba(0, 0, 0, 0.6)); border: 1px solid rgba(212, 175, 55, 0.2); border-left: 5px solid var(--gold); backdrop-filter: blur(10px); }
        .gold-text { background: linear-gradient(180deg, #fde68a 0%, #d4af37 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-gold { background: var(--gold); color: black; font-weight: 900; text-transform: uppercase; transition: 0.3s; }
        .btn-gold:active { transform: scale(0.95); box-shadow: 0 0 20px rgba(212, 175, 55, 0.5); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDQmerSSs0qhO01xNnFWpquZYseDThWxP0",
            authDomain: "lichtruc-e3f82.firebaseapp.com",
            projectId: "lichtruc-e3f82",
            storageBucket: "lichtruc-e3f82.firebasestorage.app",
            messagingSenderId: "476557236437",
            appId: "1:476557236437:web:dfb1cb5848642daecdaa5c"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const App = () => {
            const [role, setRole] = useState(null);
            const [pass, setPass] = useState("");
            const [students, setStudents] = useState([]);
            const [newName, setNewName] = useState("");
            const [newGroup, setNewGroup] = useState("");

            const accessMap = {
                "10A7MASTER": "GV", "10A7CAPTAIN": "LT", "10A7ACADEMY": "LP_HT",
                "10A7WORK": "LP_LD", "10A7BANK": "TQ", "10A7GROUP": "TT"
            };

            useEffect(() => {
                const unsub = db.collection("students").orderBy("group").onSnapshot(s => 
                    setStudents(s.docs.map(d => ({id: d.id, ...d.data()}))));
                return () => unsub();
            }, []);

            const handleLogin = () => {
                const cleanPass = pass.trim().toUpperCase();
                if (accessMap[cleanPass]) setRole(accessMap[cleanPass]);
                else alert("MÃ TRUY CẬP SAI!");
            };

            const addStudent = async () => {
                if (!newName || !newGroup) return alert("HÃY NHẬP ĐỦ TÊN VÀ TỔ!");
                await db.collection("students").add({
                    name: newName.toUpperCase(), group: parseInt(newGroup),
                    totalXp: 0, level: 1, isDebt: false
                });
                setNewName(""); setNewGroup("");
            };

            const deleteStudent = async (id, name) => {
                if (window.confirm(`XÁC NHẬN XÓA ANH HÙNG: ${name}?`)) {
                    await db.collection("students").doc(id).delete();
                }
            };

            const handleXP = async (id, pts, reason) => {
                const s = students.find(x => x.id === id);
                if (s.isDebt && pts > 0 && role !== "GV") {
                    alert("ĐANG NỢ QUỸ - KHÔNG THỂ NHẬN THƯỞNG!"); return;
                }
                await db.collection("students").doc(id).update({
                    totalXp: (s.totalXp || 0) + pts,
                    level: Math.floor(((s.totalXp || 0) + pts) / 500) + 1
                });
            };

            if (!role) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-6">
                        <h1 className="chinese-title text-6xl gold-text mb-10 text-center uppercase tracking-tighter">10A7<br/>COMMAND</h1>
                        <div className="luxury-panel p-8 w-full max-w-sm">
                            <input type="password" placeholder="NHẬP MÃ TRUY CẬP..." 
                                className="input-pro text-center tracking-widest mb-4"
                                value={pass} onChange={e => setPass(e.target.value)}
                                onKeyPress={e => e.key === 'Enter' && handleLogin()} />
                            <button onClick={handleLogin} className="w-full btn-gold py-4 rounded-lg">XÁC NHẬN TRUY CẬP</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-5xl mx-auto p-6 pb-24">
                    <header className="flex justify-between items-center mb-12">
                        <h2 className="chinese-title text-4xl gold-text">PHÚ VINH<br/><span className="text-white/10 text-sm">10A7 CLASSIC</span></h2>
                        <div className="text-right">
                            <p className="text-[10px] gold-text font-black uppercase tracking-widest">Vai trò: {role}</p>
                            <button onClick={() => setRole(null)} className="text-[10px] opacity-40 uppercase font-black underline">Đăng xuất</button>
                        </div>
                    </header>

                    {role === "GV" && (
                        <div className="luxury-panel p-6 mb-12">
                            <p className="text-xs font-black gold-text uppercase mb-4 tracking-widest">/ Chiêu mộ học sinh mới</p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <input className="input-pro uppercase" placeholder="HỌ VÀ TÊN..." value={newName} onChange={e => setNewName(e.target.value)} />
                                <select className="input-pro" value={newGroup} onChange={e => setNewGroup(e.target.value)}>
                                    <option value="">CHỌN TỔ</option>
                                    {[1,2,3,4,5,6].map(g => <option key={g} value={g}>Tổ {g}</option>)}
                                </select>
                                <button onClick={addStudent} className="btn-gold rounded-lg">THÊM HỌC SINH +</button>
                            </div>
                        </div>
                    )}

                    <div className="space-y-4">
                        <p className="text-xs font-black opacity-30 uppercase tracking-[0.3em] mb-6">/ Danh sách anh hùng 10A7</p>
                        {students.map(s => (
                            <div key={s.id} className="luxury-panel p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-4 w-full md:w-auto">
                                    {role === "GV" && (
                                        <button onClick={() => deleteStudent(s.id, s.name)} className="text-red-900 hover:text-red-500 transition-colors">
                                            <i className="fa-solid fa-trash-can"></i>
                                        </button>
                                    )}
                                    <div>
                                        <div className="flex items-center gap-3">
                                            <h3 className="text-2xl font-black gold-text uppercase chinese-title tracking-tighter">{s.name}</h3>
                                            {s.isDebt && <span className="bg-red-600/20 text-red-500 text-[9px] px-2 py-0.5 border border-red-500/30 font-black rounded">NỢ QUỸ</span>}
                                        </div>
                                        <p className="text-[10px] opacity-40 font-black uppercase">Tổ {s.group} | {s.totalXp || 0} XP | LV.{s.level || 1}</p>
                                    </div>
                                </div>

                                <div className="flex flex-wrap gap-2 justify-end w-full md:w-auto">
                                    {(role === "GV" || role === "LT" || role === "TT") && (
                                        <button onClick={() => handleXP(s.id, 10, 'Học tập')} className="px-3 py-2 bg-white/5 border border-white/10 text-[9px] font-black hover:gold-text">HỌC TẬP</button>
                                    )}
                                    {(role === "GV" || role === "LP_HT") && (
                                        <button onClick={() => handleXP(s.id, 20, 'Nề nếp')} className="px-3 py-2 bg-white/5 border border-white/10 text-[9px] font-black hover:gold-text">NỀ NẾP</button>
                                    )}
                                    {(role === "GV" || role === "LP_LD" || role === "TT") && (
                                        <button onClick={() => handleXP(s.id, 30, 'Trực nhật')} className="px-3 py-2 bg-white/5 border border-white/10 text-[9px] font-black hover:gold-text">LÀM VIỆC</button>
                                    )}
                                    {(role === "GV" || role === "TQ") && (
                                        <button onClick={() => db.collection("students").doc(s.id).update({isDebt: !s.isDebt})} 
                                            className={`px-3 py-2 border text-[9px] font-black ${s.isDebt ? 'bg-red-600 border-red-600 text-white' : 'bg-white/5 border-white/10 text-white/40'}`}>
                                            {s.isDebt ? 'ĐÃ ĐÓNG QUỸ' : 'BÁO NỢ QUỸ'}
                                        </button>
                                    )}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
